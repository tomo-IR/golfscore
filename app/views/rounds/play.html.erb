<h1> <%= @score_card_course.course%> をラウンド中です。</h1>
<p>ラウンドID： <%= @coursename %></p>
<p> <%= @score_card_score %></p>
<p>プレイ中のコース： <%= @score_card_course.course %></p>
<p>プレイヤー名： <%= @score_card_course.user.name %></p>
<p>プレイ日時： <%= @score_card_course.created_at.to_s(:datetime_jp) %></p>
<p>トータルスコア： <%= format('%+d', @score_sum) %></p>

<% @score_card_score.each do |m| %>
<span> <%= m.hole_number %>H: </span>

<% if m.hole_score == nil %>
    <span> 未 </span>
<% else %>
    <span> <%= format('%+d', m.hole_score) %> </span>
<% end %>


<span> <%= link_to "編集", hole_score_input_path(round_id: m.round_id, hole_number: m.hole_number) %> </span><br>
<% end %>


<%= link_to "トップにもどる", root_path %>



<h2>リーダーボード</h2>
<p>プレイ日時： <%= @score_card_course.created_at.strftime('%Y/%m/%d') %></p>
<p>プレイ中のコース： <%= @score_card_course.course %></p>
<% @over_under.each do |(round_id, user_id),score| %>
<span><%= format('%+d', score) %> </span>
<span><%= user_id %> さん</span><br>
<% end %>

<table>
  <% order = 1 %>
        <tr>
          <th>Rank</th>
          <th>score</th>
          <th>name</th>
          <th>THRU</th>
        </tr>
      <% @ou.each.with_index do |score,i| %>

      <% if score.overunder == @ou[i - 1].overunder || score.overunder == @ou[(i + 1)%@ou.size].overunder  %> 
        <% post_fix = "T" %>
      <% else %>
        <% post_fix = "" %>
      <% end %>
      <% order = i + 1 unless score.overunder == @ou[i - 1].overunder %>
      <tr>
       <th><%= format('%d位%s', order,post_fix) %></th>  
      <th><%= format('%+d', score.overunder) %></th>  
      
      </tr>
  <% end %>
</table>


<p>ここからTHRU</p>
<% ha = Hash[@thru_1h_start] %>
<% hb = Hash[@thru_10h_start] %>
<% keys = ha.keys | hb.keys %>
<% values_a = ha.values_at(*keys) %>
<% values_b = hb.values %>
<% keys.zip(values_a, values_b) do |key, a, b| %>
<span>
  <% if    a.nil? && b.nil?             %>Finish a=<%=a.inspect%>,b=<%=b.inspect%>,key=<%=key.inspect%>
  <% elsif a.nil? && b&.between?(11,18) %>アウトスタートで、インプレイ中 a=<%=a.inspect%>,b=<%=b.inspect%>,key=<%=key.inspect%>
  <% elsif a.nil? && b == 10            %>アウトスタートで、アウト終了 9H  a=<%=a.inspect%>,b=<%=b.inspect%>,key=<%=key.inspect%>
  <% elsif a == 1 && b.nil?             %>インスタートで、イン終了 18H  a=<%=a.inspect%>,b=<%=b.inspect%>,key=<%=key.inspect%>
  <% elsif a == 1 && b&.between?(11,18) %>インスタートで、インプレイ中 a=<%=a.inspect%>,b=<%=b.inspect%>,key=<%=key.inspect%>
  <% elsif a&.between?(2,9) && b == 10  %>アウトスタートで、アウトプレイ中 a=<%=a.inspect%>,b=<%=b.inspect%>,key=<%=key.inspect%>
  <% elsif a&.between?(2,9) && b.nil?   %>インスタートで、アウトプレイ中 a=<%=a.inspect%>,b=<%=b.inspect%>,key=<%=key.inspect%>
  <% else %>なんか変なスコアのいれ方です    a=<%=a.inspect%>,b=<%=b.inspect%>,key=<%=key.inspect%>
  <% end %>
</span><br>
 <% end %>



<h2><%= @score_card_course.course %>のメッセージボード</h2>

<%= form_with url:round_message_post_path do |f| %>
  <%= f.label :content, 'メッセージ' %>
  <%= f.text_field :content %>
  <%= f.submit "投稿する" %>
<% end %>

<% @messages.each do |m| %>
<span> <%= m.content %> </span>
<span> <%= m.created_at %> </span>
<span>投稿者 <%= m.user.name %> さん</span><br>
<% end %>

<%= 
# @play_day.created_at.strftime('%Y/%m/%d') 
%>
